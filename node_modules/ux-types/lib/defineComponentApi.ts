import { isFunction, ProjectType } from './shared';
import { ComponentPropsOptions, ExtractPropTypes } from './props';
import { CreateComponentPublicInstance } from './componentPublicInstance';
import {
	ComponentOptionsWithNoProps,
	ComponentOptionsWithArrayProps,
	ComponentOptionsWithObjectProps,
	ComputedOptions
} from './componentOptions';

export type DefineComponent<
	PropsOrPropOptions = {},
	Private = {},
	Protected = {},
	Public = {},
	D = {},
	C extends ComputedOptions = {},
	O = {},
	T extends ProjectType = 'quickapp',
	Props = Readonly<
		PropsOrPropOptions extends ComponentPropsOptions ? ExtractPropTypes<PropsOrPropOptions> : PropsOrPropOptions
	>
> = CreateComponentPublicInstance<Props, Private, Protected, Public, D, C, O, T>;

/** overWrite1 no props */
export function defineComponent<
	Props = {},
	Private = {},
	Protected = {},
	Public = {},
	D = {},
	C extends ComputedOptions = {},
	O = {},
	T extends ProjectType = 'quickapp'
>(
	options: O & ComponentOptionsWithNoProps<{ props?: undefined }, Private, Protected, Public, D, C, O, T>,
	type?: T
): DefineComponent<{ props?: undefined }, Private, Protected, Public, D, C, O, T>;

/** overwrite2 string arr props */
export function defineComponent<
	PropsNames extends string,
	Private = {},
	Protected = {},
	Public = {},
	D = {},
	C extends ComputedOptions = {},
	O = {},
	T extends ProjectType = 'quickapp'
>(
	options: O & ComponentOptionsWithArrayProps<PropsNames, Private, Protected, Public, D, C, O, T>,
	type?: T
): DefineComponent<Readonly<{ [key in PropsNames]?: any }>, Private, Protected, Public, D, C, O, T>;

/** overwrite3 obj props */
export function defineComponent<
	Props extends Readonly<ComponentPropsOptions>,
	Private = {},
	Protected = {},
	Public = {},
	D = {},
	C extends ComputedOptions = {},
	O = {},
	T extends ProjectType = 'quickapp'
>(
	options: O & ComponentOptionsWithObjectProps<Props, Private, Protected, Public, D, C, O, T>,
	type?: T
): DefineComponent<Props, Private, Protected, Public, D, C, O, T>;

// implementation, close to no-op
export function defineComponent(options: unknown, type = 'quickapp') {
	return isFunction(options) ? { name: options.name } : options;
}
