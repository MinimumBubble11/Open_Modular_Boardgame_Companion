"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _TypescriptUtil = _interopRequireDefault(require("../../utils/TypescriptUtil"));
var _RenderValidate = _interopRequireDefault(require("../../validate/RenderValidate"));
var _ElementBase = _interopRequireDefault(require("./ElementBase"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * ForElement
 * @description 示例源码
 * ```js
 * ForEach(
 *  arr,                // 循环对象
 *  (item, index)=>{},  // 渲染函数
 *  (item, index)=>{}   // key 函数
 * )
 * ```
 */
class ForElement extends _ElementBase.default {
  /**
   * 采集对象
   */

  /**
   * 生成 key 的函数
   */

  /**
   * 渲染参数列表
   */

  /**
   * 渲染元素列表
   */

  /**
   * 采集 for 元素
   *
   * @description 源码如下，采集为1个 forElement
   * ```js
   * ForEach(arr, (item, index)=>{}, (item, index)=>item.key)
   * ```
   *
   * ### 采集步骤
   * 1. 第1个参数作为循环目标： target
   * 2. 第2个参数作为 render函数，基参数为 renderArguments、其函数体子元素为 renderElementList
   * 3. 第3个参数作为生成 key 的函数 keyFunction
   *
   * @param context
   * @param nodeList
   * @param startIndex
   * @param collectChildren
   * @returns
   */
  static collect(context, nodeList, startIndex, collectChildren) {
    const callFunction = nodeList[startIndex].getExpression();
    const argumentList = callFunction.getArguments();
    // ForEach参数检查
    new _RenderValidate.default().validateForEach(context, nodeList[startIndex], argumentList);
    const element = new ForElement();
    element.target = argumentList[0];
    const renderFunction = argumentList[1];
    element.renderArguments = renderFunction.getParameters();
    element.keyFunction = argumentList[2];
    const children = _TypescriptUtil.default.getBlockChildren(renderFunction.getBody());
    if (children && children.length) {
      element.renderElementList = collectChildren(children);
    }
    return {
      element,
      offset: 1
    };
  }
  static match(node) {
    return new _RenderValidate.default().checkNodeIsForEach(node);
  }
}
var _default = exports.default = ForElement;