"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _tsMorph = require("ts-morph");
var _TypescriptUtil = _interopRequireDefault(require("../../utils/TypescriptUtil"));
var _ElementBase = _interopRequireDefault(require("./ElementBase"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * 表示 if else 的元素
 *
 * @description 示例源码
 * ```js
 * if(x){}      // 1个 if
 * else if(){}  // 任意个 else if
 * else {}       // 1 或 n 个 else
 * ```
 */
class IfElement extends _ElementBase.default {
  /**
   * 元素列表
   */
  elements = [];

  /**
   * 后续的 if else/else 元素
   */

  /**
   * 条件表达式
   */

  constructor() {
    super();
  }
  get isElse() {
    return !Boolean(this.expression);
  }
  static match(node) {
    return node.getKind() === _tsMorph.SyntaxKind.IfStatement;
  }
  static collect(context, nodeList, startIndex, collectChildren) {
    const node = nodeList[startIndex];
    const element = this.ifStatementToIfElement(node, collectChildren);
    return {
      element,
      offset: 1
    };
  }

  /**
   * if else转换为 ifElement
   *
   * @description 源码如下，转换为**1**个 IfElement
   * ```js
   * if(x){ Row1() }
   * else if(y) { Row2() }
   * else { Row3() }
   * ```
   *
   * 转换过程为：
   * 1. 检查元素是否为 else
   * 2. 如果是 else, 则获取 else 中的元素--Row3()
   * 3. 否则，获取: a. if 的条件表达式、b. if 自身的元素--Row1()、c. 递归获取后续的 else 或 if else
   * @param statement
   * @param collectChildren
   * @returns
   */
  static ifStatementToIfElement(statement, collectChildren) {
    const isElse = statement.getKind() === _tsMorph.SyntaxKind.Block;
    let result = new IfElement();
    if (isElse) {
      result.elements = collectChildren(_TypescriptUtil.default.getBlockChildren(statement));
    } else {
      result.expression = statement.getExpression();
      result.elements = collectChildren(_TypescriptUtil.default.getBlockChildren(statement.getThenStatement()));
      const elesStatement = statement.getElseStatement();
      if (elesStatement) {
        result.elseElement = this.ifStatementToIfElement(statement.getElseStatement(), collectChildren);
      }
    }
    return result;
  }
}
var _default = exports.default = IfElement;